How to write idempotent Bash scripts